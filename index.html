<!doctype html>

<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Seller Inventory Manager — Template</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4;--glass:rgba(255,255,255,0.04)}
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{margin:0;background:linear-gradient(180deg,#0b1320 0%, #071021 100%);color:#e6eef6}
    header{padding:18px 20px;display:flex;align-items:center;gap:16px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .logo{font-weight:700;letter-spacing:0.6px}
    .container{max-width:1200px;margin:20px auto;padding:16px}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:18px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=number], input[type=date], select, textarea{width:100%;padding:9px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    textarea{min-height:80px}
    .two{display:flex;gap:10px}
    .two .w{flex:1}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#012;cursor:pointer;font-weight:600}
    .muted{color:var(--muted);font-size:13px}
    .product-list{max-height:62vh;overflow:auto;padding:8px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:13px}
    .small{font-size:12px;color:var(--muted)}
    .actions button{margin-right:6px}
    .img-preview{width:60px;height:60px;border-radius:6px;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}
    .top-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .tag{display:inline-block;padding:4px 8px;border-radius:999px;background:var(--glass);color:var(--muted);font-size:12px;margin-right:6px}
    .search{display:flex;gap:8px;margin-bottom:10px}
    .search input{flex:1}
    .footer{margin-top:10px;color:var(--muted);font-size:13px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:13px}
    @media (max-width:880px){.grid{grid-template-columns:1fr;}.product-list{max-height:45vh}}
  </style>
</head>
<body>
  <header>
    <div class="logo">Seller Inventory Manager</div>
    <div class="muted">— Full product data template (local, offline)</div>
  </header>  <div class="container">
    <div class="grid">
      <!-- LEFT: Product Form -->
      <div class="card">
        <h3 style="margin:6px 0 10px">Naya Product / Edit</h3>
        <form id="productForm">
          <label>Product Title</label>
          <input type="text" id="title" placeholder="Product ka naam" required /><div style="height:10px"></div>

      <div class="two">
        <div class="w">
          <label>SKU / Barcode</label>
          <input type="text" id="sku" placeholder="SKU ya barcode" />
        </div>
        <div class="w">
          <label>Brand</label>
          <input type="text" id="brand" placeholder="Brand name" />
        </div>
      </div>

      <div style="height:10px"></div>

      <label>Marketplace</label>
      <select id="marketplace">
        <option value="">— Select —</option>
        <option>Amazon</option>
        <option>Flipkart</option>
        <option>Meesho</option>
        <option>Own Website</option>
        <option>Other</option>
      </select>

      <div style="height:10px"></div>

      <div class="two">
        <div class="w">
          <label>Category / Subcategory</label>
          <input type="text" id="category" placeholder="Clothing > Men > T-Shirt" />
        </div>
        <div class="w">
          <label>Tags (comma)</label>
          <input type="text" id="tags" placeholder="e.g. cotton,printed,summer" />
        </div>
      </div>

      <div style="height:10px"></div>

      <label>Sizes / Variants (comma)</label>
      <input type="text" id="sizes" placeholder="S,M,L,XL" />

      <div style="height:10px"></div>

      <div class="two">
        <div class="w">
          <label>Purchase Price (₹)</label>
          <input type="number" id="cost" min="0" step="0.01" />
        </div>
        <div class="w">
          <label>Selling Price (₹)</label>
          <input type="number" id="price" min="0" step="0.01" />
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="two">
        <div class="w">
          <label>Shipping Cost (₹)</label>
          <input type="number" id="shipping" min="0" step="0.01" />
        </div>
        <div class="w">
          <label>GST %</label>
          <input type="number" id="gst" min="0" step="0.01" value="0" />
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="two">
        <div class="w">
          <label>Weight (kg)</label>
          <input type="number" id="weight" min="0" step="0.001" />
        </div>
        <div class="w">
          <label>Dimensions (L×W×H cm)</label>
          <input type="text" id="dimensions" placeholder="30x20x2" />
        </div>
      </div>

      <div style="height:10px"></div>

      <label>Stock Qty</label>
      <input type="number" id="stock" min="0" step="1" />

      <div style="height:10px"></div>

      <label>Supplier / Manufacturer</label>
      <input type="text" id="supplier" placeholder="Supplier name, contact" />

      <div style="height:10px"></div>

      <label>Purchase Date</label>
      <input type="date" id="purchaseDate" />

      <div style="height:10px"></div>

      <label>Images (1-3) — preview below</label>
      <input type="file" id="images" accept="image/*" multiple />
      <div id="preview" style="display:flex;gap:8px;margin-top:8px"></div>

      <div style="height:10px"></div>

      <label>Notes / Listing Description</label>
      <textarea id="notes" placeholder="Extra details, listing copy, measurements..."></textarea>

      <div style="height:12px"></div>

      <div style="display:flex;gap:8px;align-items:center">
        <button type="submit">Save Product</button>
        <button type="button" id="clearForm" style="background:#334155;color:#fff">Reset</button>
        <div style="flex:1"></div>
        <div class="pill small">Auto-save: localStorage</div>
      </div>
    </form>

    <div class="footer">Tip: Yeh file locally browser me open karke use karo. Data browser ke localStorage me save hota hai — agar host karna hai to simple static host (GitHub Pages) pe daal do.</div>
  </div>

  <!-- RIGHT: Product List & Tools -->
  <div>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <h3 style="margin:0">Products</h3>
        <div class="top-actions">
          <div class="search">
            <input id="q" placeholder="Search by title, SKU, tag..." />
            <button id="searchBtn">Search</button>
          </div>
          <button id="exportCsv">Export CSV</button>
          <button id="exportJson">Export JSON</button>
          <button id="importBtn" style="background:#64748b">Import JSON</button>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button id="clearAll" style="background:#ef4444;color:white">Clear All</button>
        </div>
      </div>

      <div class="product-list card" style="padding:8px">
        <table id="productsTable">
          <thead>
            <tr>
              <th style="width:40px">#</th>
              <th>Preview</th>
              <th>Title / SKU</th>
              <th>Marketplace</th>
              <th class="small">Price</th>
              <th class="small">Stock</th>
              <th class="small">Tags</th>
              <th style="width:160px">Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div style="margin-top:8px" class="small muted">Use edit to update listing before pushing to Amazon/Flipkart. Export CSV to format for bulk upload templates.</div>
    </div>

    <div style="height:12px"></div>

    <div class="card">
      <h4 style="margin:4px 0">Quick Analytics</h4>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div class="card" style="padding:10px;min-width:180px">Total SKUs: <div id="statTotal">0</div></div>
        <div class="card" style="padding:10px;min-width:180px">Total Stock: <div id="statStock">0</div></div>
        <div class="card" style="padding:10px;min-width:180px">Avg Margin: <div id="statMargin">0%</div></div>
      </div>
      <div class="small muted" style="margin-top:8px">Margin = (Selling - Cost - Shipping - GST) / Selling * 100 (approx)</div>
    </div>
  </div>
</div>

  </div>  <script>
    // Simple offline inventory manager — all data stored in localStorage under key 'siv_products'
    const form = document.getElementById('productForm');
    const preview = document.getElementById('preview');
    const imagesInput = document.getElementById('images');
    const productsKey = 'siv_products_v1';
    let products = JSON.parse(localStorage.getItem(productsKey) || '[]');
    let editingIndex = -1;

    function dataURL(file){
      return new Promise((res, rej)=>{
        const reader = new FileReader();
        reader.onload = e => res(e.target.result);
        reader.onerror = e => rej(e);
        reader.readAsDataURL(file);
      })
    }

    imagesInput.addEventListener('change', async e => {
      preview.innerHTML = '';
      const files = Array.from(e.target.files).slice(0,3);
      for (const f of files){
        try{
          const url = await dataURL(f);
          const img = document.createElement('img'); img.src = url; img.className='img-preview';
          preview.appendChild(img);
        }catch(err){console.error(err)}
      }
    })

    form.addEventListener('submit', async ev => {
      ev.preventDefault();
      const obj = await readForm();
      if(editingIndex >= 0){
        products[editingIndex] = obj; editingIndex = -1;
      } else products.push(obj);
      saveAndRender(); form.reset(); preview.innerHTML='';
    })

    async function readForm(){
      const imgs = Array.from(imagesInput.files).slice(0,3);
      const dataImgs = [];
      for(const f of imgs){
        try{dataImgs.push(await dataURL(f))}catch(e){console.warn(e)}
      }
      const cost = parseFloat(document.getElementById('cost').value || 0);
      const price = parseFloat(document.getElementById('price').value || 0);
      const shipping = parseFloat(document.getElementById('shipping').value || 0);
      const gst = parseFloat(document.getElementById('gst').value || 0);
      const stock = parseInt(document.getElementById('stock').value || 0);

      return {
        id: Date.now() + Math.floor(Math.random()*999),
        title: document.getElementById('title').value.trim(),
        sku: document.getElementById('sku').value.trim(),
        brand: document.getElementById('brand').value.trim(),
        marketplace: document.getElementById('marketplace').value,
        category: document.getElementById('category').value.trim(),
        tags: document.getElementById('tags').value.split(',').map(s=>s.trim()).filter(Boolean),
        sizes: document.getElementById('sizes').value.split(',').map(s=>s.trim()).filter(Boolean),
        cost, price, shipping, gst, weight: parseFloat(document.getElementById('weight').value || 0),
        dimensions: document.getElementById('dimensions').value.trim(),
        stock, supplier: document.getElementById('supplier').value.trim(),
        purchaseDate: document.getElementById('purchaseDate').value || null,
        images: dataImgs,
        notes: document.getElementById('notes').value.trim()
      }
    }

    function saveAndRender(){
      localStorage.setItem(productsKey, JSON.stringify(products));
      renderProducts(); updateStats();
    }

    function renderProducts(list = products){
      const tbody = document.querySelector('#productsTable tbody'); tbody.innerHTML='';
      list.forEach((p,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${p.images && p.images[0] ? '<img src="'+p.images[0]+'" class="img-preview"/>' : ''}</td>
          <td><strong>${escapeHtml(p.title||'—')}</strong><div class="small">${escapeHtml(p.sku||'')}</div></td>
          <td>${escapeHtml(p.marketplace||'')}</td>
          <td class="small">₹${(p.price||0).toFixed(2)}</td>
          <td class="small">${p.stock||0}</td>
          <td class="small">${(p.tags||[]).slice(0,3).map(t=>'<span class="tag">'+escapeHtml(t)+'</span>').join('')}</td>
          <td class="actions">
            <button onclick="editProduct(${p.id})">Edit</button>
            <button onclick="deleteProduct(${p.id})" style="background:#ef4444;color:#fff">Delete</button>
            <button onclick="duplicateProduct(${p.id})" style="background:#64748b;color:#fff">Duplicate</button>
          </td>
        `;
        tbody.appendChild(tr);
      })
    }

    function escapeHtml(s){return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

    window.editProduct = function(id){
      const idx = products.findIndex(p=>p.id===id); if(idx<0) return; const p = products[idx]; editingIndex = idx;
      document.getElementById('title').value = p.title || '';
      document.getElementById('sku').value = p.sku || '';
      document.getElementById('brand').value = p.brand || '';
      document.getElementById('marketplace').value = p.marketplace || '';
      document.getElementById('category').value = p.category || '';
      document.getElementById('tags').value = (p.tags||[]).join(',');
      document.getElementById('sizes').value = (p.sizes||[]).join(',');
      document.getElementById('cost').value = p.cost || '';
      document.getElementById('price').value = p.price || '';
      document.getElementById('shipping').value = p.shipping || '';
      document.getElementById('gst').value = p.gst || 0;
      document.getElementById('weight').value = p.weight || '';
      document.getElementById('dimensions').value = p.dimensions || '';
      document.getElementById('stock').value = p.stock || '';
      document.getElementById('supplier').value = p.supplier || '';
      document.getElementById('purchaseDate').value = p.purchaseDate || '';
      document.getElementById('notes').value = p.notes || '';
      // show previews (images can't be re-populated to input[file] — show thumbnails)
      preview.innerHTML=''; (p.images||[]).slice(0,3).forEach(src=>{const img=document.createElement('img');img.src=src;img.className='img-preview';preview.appendChild(img)})
      window.scrollTo({top:0,behavior:'smooth'});
    }

    window.deleteProduct = function(id){
      if(!confirm('Delete this product?')) return; products = products.filter(p=>p.id!==id); saveAndRender();
    }

    window.duplicateProduct = function(id){
      const p = products.find(x=>x.id===id); if(!p) return; const copy = JSON.parse(JSON.stringify(p)); copy.id = Date.now()+Math.floor(Math.random()*999); copy.sku = (copy.sku||'') + '-COPY'; products.push(copy); saveAndRender();
    }

    document.getElementById('searchBtn').addEventListener('click', ()=>{
      const q = document.getElementById('q').value.trim().toLowerCase();
      if(!q) return renderProducts();
      const filtered = products.filter(p=>{
        return (p.title||'').toLowerCase().includes(q) || (p.sku||'').toLowerCase().includes(q) || (p.tags||[]).join(' ').toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q)
      })
      renderProducts(filtered);
    })

    document.getElementById('clearForm').addEventListener('click', ()=>{form.reset(); preview.innerHTML=''; editingIndex=-1})

    document.getElementById('exportJson').addEventListener('click', ()=>{
      const data = JSON.stringify(products, null, 2); downloadFile('products.json', data, 'application/json')
    })

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!products.length){alert('Koi products nahi');return}
      const cols = ['id','title','sku','brand','marketplace','category','tags','sizes','cost','price','shipping','gst','weight','dimensions','stock','supplier','purchaseDate','notes'];
      const rows = products.map(p=>cols.map(c=>escapeCsv((p[c] instanceof Array? p[c].join('|') : (p[c]||'')))).join(','));
      const csv = cols.join(',') + '\n' + rows.join('\n');
      downloadFile('products.csv', csv, 'text/csv');
    })

    function escapeCsv(s){return '"'+(s+'').replace(/"/g,'""')+'"'}

    function downloadFile(name, data, type){
      const blob = new Blob([data], {type}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = name; a.click(); URL.revokeObjectURL(url);
    }

    document.getElementById('importBtn').addEventListener('click', ()=>document.getElementById('importFile').click())
    document.getElementById('importFile').addEventListener('change', ev=>{
      const f = ev.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = e=>{
        try{ const json = JSON.parse(e.target.result); if(Array.isArray(json)) products = products.concat(json); else alert('JSON should be an array of products'); saveAndRender(); }catch(err){alert('Invalid JSON')}
      }; reader.readAsText(f);
    })

    document.getElementById('clearAll').addEventListener('click', ()=>{ if(confirm('Clear all products and localStorage?')){products=[]; localStorage.removeItem(productsKey); renderProducts(); updateStats();}})

    function updateStats(){
      document.getElementById('statTotal').innerText = products.length;
      const totalStock = products.reduce((s,p)=>s + (p.stock||0),0);
      document.getElementById('statStock').innerText = totalStock;
      const margins = products.map(p=>{
        const sell = p.price||0; const cost = p.cost||0; const ship = p.shipping||0; const gst = (p.gst||0);
        if(!sell) return 0; const margin = ((sell - cost - ship - (sell*gst/100))/sell) * 100; return margin;
      }).filter(n=>isFinite(n));
      const avg = margins.length? (margins.reduce((a,b)=>a+b,0)/margins.length):0; document.getElementById('statMargin').innerText = avg.toFixed(2)+'%';
    }

    // initial render
    renderProducts(); updateStats();

    // autosave form draft (very small)
    const draftKey = 'siv_draft_v1';
    setInterval(()=>{
      try{
        const draft = {
          title:document.getElementById('title').value,
          sku:document.getElementById('sku').value,
          brand:document.getElementById('brand').value,
        };
        localStorage.setItem(draftKey, JSON.stringify(draft));
      }catch(e){}
    },3000);

  </script></body>
</html>          <input type="number" id="shipping" min="0" step="0.01" />
        </div>
        <div class="w">
          <label>GST %</label>
          <input type="number" id="gst" min="0" step="0.01" value="0" />
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="two">
        <div class="w">
          <label>Weight (kg)</label>
          <input type="number" id="weight" min="0" step="0.001" />
        </div>
        <div class="w">
          <label>Dimensions (L×W×H cm)</label>
          <input type="text" id="dimensions" placeholder="30x20x2" />
        </div>
      </div>

      <div style="height:10px"></div>

      <label>Stock Qty</label>
      <input type="number" id="stock" min="0" step="1" />

      <div style="height:10px"></div>

      <label>Supplier / Manufacturer</label>
      <input type="text" id="supplier" placeholder="Supplier name, contact" />

      <div style="height:10px"></div>

      <label>Purchase Date</label>
      <input type="date" id="purchaseDate" />

      <div style="height:10px"></div>

      <label>Images (1-3) — preview below</label>
      <input type="file" id="images" accept="image/*" multiple />
      <div id="preview" style="display:flex;gap:8px;margin-top:8px"></div>

      <div style="height:10px"></div>

      <label>Notes / Listing Description</label>
      <textarea id="notes" placeholder="Extra details, listing copy, measurements..."></textarea>

      <div style="height:12px"></div>

      <div style="display:flex;gap:8px;align-items:center">
        <button type="submit">Save Product</button>
        <button type="button" id="clearForm" style="background:#334155;color:#fff">Reset</button>
        <div style="flex:1"></div>
        <div class="pill small">Auto-save: localStorage</div>
      </div>
    </form>

    <div class="footer">Tip: Yeh file locally browser me open karke use karo. Data browser ke localStorage me save hota hai — agar host karna hai to simple static host (GitHub Pages) pe daal do.</div>
  </div>

  <!-- RIGHT: Product List & Tools -->
  <div>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <h3 style="margin:0">Products</h3>
        <div class="top-actions">
          <div class="search">
            <input id="q" placeholder="Search by title, SKU, tag..." />
            <button id="searchBtn">Search</button>
          </div>
          <button id="exportCsv">Export CSV</button>
          <button id="exportJson">Export JSON</button>
          <button id="importBtn" style="background:#64748b">Import JSON</button>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button id="clearAll" style="background:#ef4444;color:white">Clear All</button>
        </div>
      </div>

      <div class="product-list card" style="padding:8px">
        <table id="productsTable">
          <thead>
            <tr>
              <th style="width:40px">#</th>
              <th>Preview</th>
              <th>Title / SKU</th>
              <th>Marketplace</th>
              <th class="small">Price</th>
              <th class="small">Stock</th>
              <th class="small">Tags</th>
              <th style="width:160px">Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div style="margin-top:8px" class="small muted">Use edit to update listing before pushing to Amazon/Flipkart. Export CSV to format for bulk upload templates.</div>
    </div>

    <div style="height:12px"></div>

    <div class="card">
      <h4 style="margin:4px 0">Quick Analytics</h4>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div class="card" style="padding:10px;min-width:180px">Total SKUs: <div id="statTotal">0</div></div>
        <div class="card" style="padding:10px;min-width:180px">Total Stock: <div id="statStock">0</div></div>
        <div class="card" style="padding:10px;min-width:180px">Avg Margin: <div id="statMargin">0%</div></div>
      </div>
      <div class="small muted" style="margin-top:8px">Margin = (Selling - Cost - Shipping - GST) / Selling * 100 (approx)</div>
    </div>
  </div>
</div>

  </div>  <script>
    // Simple offline inventory manager — all data stored in localStorage under key 'siv_products'
    const form = document.getElementById('productForm');
    const preview = document.getElementById('preview');
    const imagesInput = document.getElementById('images');
    const productsKey = 'siv_products_v1';
    let products = JSON.parse(localStorage.getItem(productsKey) || '[]');
    let editingIndex = -1;

    function dataURL(file){
      return new Promise((res, rej)=>{
        const reader = new FileReader();
        reader.onload = e => res(e.target.result);
        reader.onerror = e => rej(e);
        reader.readAsDataURL(file);
      })
    }

    imagesInput.addEventListener('change', async e => {
      preview.innerHTML = '';
      const files = Array.from(e.target.files).slice(0,3);
      for (const f of files){
        try{
          const url = await dataURL(f);
          const img = document.createElement('img'); img.src = url; img.className='img-preview';
          preview.appendChild(img);
        }catch(err){console.error(err)}
      }
    })

    form.addEventListener('submit', async ev => {
      ev.preventDefault();
      const obj = await readForm();
      if(editingIndex >= 0){
        products[editingIndex] = obj; editingIndex = -1;
      } else products.push(obj);
      saveAndRender(); form.reset(); preview.innerHTML='';
    })

    async function readForm(){
      const imgs = Array.from(imagesInput.files).slice(0,3);
      const dataImgs = [];
      for(const f of imgs){
        try{dataImgs.push(await dataURL(f))}catch(e){console.warn(e)}
      }
      const cost = parseFloat(document.getElementById('cost').value || 0);
      const price = parseFloat(document.getElementById('price').value || 0);
      const shipping = parseFloat(document.getElementById('shipping').value || 0);
      const gst = parseFloat(document.getElementById('gst').value || 0);
      const stock = parseInt(document.getElementById('stock').value || 0);

      return {
        id: Date.now() + Math.floor(Math.random()*999),
        title: document.getElementById('title').value.trim(),
        sku: document.getElementById('sku').value.trim(),
        brand: document.getElementById('brand').value.trim(),
        marketplace: document.getElementById('marketplace').value,
        category: document.getElementById('category').value.trim(),
        tags: document.getElementById('tags').value.split(',').map(s=>s.trim()).filter(Boolean),
        sizes: document.getElementById('sizes').value.split(',').map(s=>s.trim()).filter(Boolean),
        cost, price, shipping, gst, weight: parseFloat(document.getElementById('weight').value || 0),
        dimensions: document.getElementById('dimensions').value.trim(),
        stock, supplier: document.getElementById('supplier').value.trim(),
        purchaseDate: document.getElementById('purchaseDate').value || null,
        images: dataImgs,
        notes: document.getElementById('notes').value.trim()
      }
    }

    function saveAndRender(){
      localStorage.setItem(productsKey, JSON.stringify(products));
      renderProducts(); updateStats();
    }

    function renderProducts(list = products){
      const tbody = document.querySelector('#productsTable tbody'); tbody.innerHTML='';
      list.forEach((p,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${p.images && p.images[0] ? '<img src="'+p.images[0]+'" class="img-preview"/>' : ''}</td>
          <td><strong>${escapeHtml(p.title||'—')}</strong><div class="small">${escapeHtml(p.sku||'')}</div></td>
          <td>${escapeHtml(p.marketplace||'')}</td>
          <td class="small">₹${(p.price||0).toFixed(2)}</td>
          <td class="small">${p.stock||0}</td>
          <td class="small">${(p.tags||[]).slice(0,3).map(t=>'<span class="tag">'+escapeHtml(t)+'</span>').join('')}</td>
          <td class="actions">
            <button onclick="editProduct(${p.id})">Edit</button>
            <button onclick="deleteProduct(${p.id})" style="background:#ef4444;color:#fff">Delete</button>
            <button onclick="duplicateProduct(${p.id})" style="background:#64748b;color:#fff">Duplicate</button>
          </td>
        `;
        tbody.appendChild(tr);
      })
    }

    function escapeHtml(s){return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

    window.editProduct = function(id){
      const idx = products.findIndex(p=>p.id===id); if(idx<0) return; const p = products[idx]; editingIndex = idx;
      document.getElementById('title').value = p.title || '';
      document.getElementById('sku').value = p.sku || '';
      document.getElementById('brand').value = p.brand || '';
      document.getElementById('marketplace').value = p.marketplace || '';
      document.getElementById('category').value = p.category || '';
      document.getElementById('tags').value = (p.tags||[]).join(',');
      document.getElementById('sizes').value = (p.sizes||[]).join(',');
      document.getElementById('cost').value = p.cost || '';
      document.getElementById('price').value = p.price || '';
      document.getElementById('shipping').value = p.shipping || '';
      document.getElementById('gst').value = p.gst || 0;
      document.getElementById('weight').value = p.weight || '';
      document.getElementById('dimensions').value = p.dimensions || '';
      document.getElementById('stock').value = p.stock || '';
      document.getElementById('supplier').value = p.supplier || '';
      document.getElementById('purchaseDate').value = p.purchaseDate || '';
      document.getElementById('notes').value = p.notes || '';
      // show previews (images can't be re-populated to input[file] — show thumbnails)
      preview.innerHTML=''; (p.images||[]).slice(0,3).forEach(src=>{const img=document.createElement('img');img.src=src;img.className='img-preview';preview.appendChild(img)})
      window.scrollTo({top:0,behavior:'smooth'});
    }

    window.deleteProduct = function(id){
      if(!confirm('Delete this product?')) return; products = products.filter(p=>p.id!==id); saveAndRender();
    }

    window.duplicateProduct = function(id){
      const p = products.find(x=>x.id===id); if(!p) return; const copy = JSON.parse(JSON.stringify(p)); copy.id = Date.now()+Math.floor(Math.random()*999); copy.sku = (copy.sku||'') + '-COPY'; products.push(copy); saveAndRender();
    }

    document.getElementById('searchBtn').addEventListener('click', ()=>{
      const q = document.getElementById('q').value.trim().toLowerCase();
      if(!q) return renderProducts();
      const filtered = products.filter(p=>{
        return (p.title||'').toLowerCase().includes(q) || (p.sku||'').toLowerCase().includes(q) || (p.tags||[]).join(' ').toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q)
      })
      renderProducts(filtered);
    })

    document.getElementById('clearForm').addEventListener('click', ()=>{form.reset(); preview.innerHTML=''; editingIndex=-1})

    document.getElementById('exportJson').addEventListener('click', ()=>{
      const data = JSON.stringify(products, null, 2); downloadFile('products.json', data, 'application/json')
    })

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!products.length){alert('Koi products nahi');return}
      const cols = ['id','title','sku','brand','marketplace','category','tags','sizes','cost','price','shipping','gst','weight','dimensions','stock','supplier','purchaseDate','notes'];
      const rows = products.map(p=>cols.map(c=>escapeCsv((p[c] instanceof Array? p[c].join('|') : (p[c]||'')))).join(','));
      const csv = cols.join(',') + '\n' + rows.join('\n');
      downloadFile('products.csv', csv, 'text/csv');
    })

    function escapeCsv(s){return '"'+(s+'').replace(/"/g,'""')+'"'}

    function downloadFile(name, data, type){
      const blob = new Blob([data], {type}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = name; a.click(); URL.revokeObjectURL(url);
    }

    document.getElementById('importBtn').addEventListener('click', ()=>document.getElementById('importFile').click())
    document.getElementById('importFile').addEventListener('change', ev=>{
      const f = ev.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = e=>{
        try{ const json = JSON.parse(e.target.result); if(Array.isArray(json)) products = products.concat(json); else alert('JSON should be an array of products'); saveAndRender(); }catch(err){alert('Invalid JSON')}
      }; reader.readAsText(f);
    })

    document.getElementById('clearAll').addEventListener('click', ()=>{ if(confirm('Clear all products and localStorage?')){products=[]; localStorage.removeItem(productsKey); renderProducts(); updateStats();}})

    function updateStats(){
      document.getElementById('statTotal').innerText = products.length;
      const totalStock = products.reduce((s,p)=>s + (p.stock||0),0);
      document.getElementById('statStock').innerText = totalStock;
      const margins = products.map(p=>{
        const sell = p.price||0; const cost = p.cost||0; const ship = p.shipping||0; const gst = (p.gst||0);
        if(!sell) return 0; const margin = ((sell - cost - ship - (sell*gst/100))/sell) * 100; return margin;
      }).filter(n=>isFinite(n));
      const avg = margins.length? (margins.reduce((a,b)=>a+b,0)/margins.length):0; document.getElementById('statMargin').innerText = avg.toFixed(2)+'%';
    }

    // initial render
    renderProducts(); updateStats();

    // autosave form draft (very small)
    const draftKey = 'siv_draft_v1';
    setInterval(()=>{
      try{
        const draft = {
          title:document.getElementById('title').value,
          sku:document.getElementById('sku').value,
          brand:document.getElementById('brand').value,
        };
        localStorage.setItem(draftKey, JSON.stringify(draft));
      }catch(e){}
    },3000);

  </script></body>
</html>
